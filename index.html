<!DOCTYPE html>
<html>
<!-- ... остальные стили без изменений ... -->

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();

    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');
    const chatArea = document.getElementById('chatArea');

    function addMessage(text, isUser = false) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
        messageDiv.textContent = text;
        chatArea.appendChild(messageDiv);
        chatArea.scrollTop = chatArea.scrollHeight;
    }

    async function sendMessage() {
        const message = messageInput.value.trim();
        if (!message) return;

        // Блокируем интерфейс
        messageInput.disabled = true;
        sendButton.disabled = true;

        // Добавляем сообщение пользователя
        addMessage(message, true);
        messageInput.value = '';

        try {
            // Показываем индикатор загрузки
            addMessage('⌛ Ожидание ответа...', false);

            // Отправляем сообщение через Telegram WebApp
            await tg.sendData(JSON.stringify({
                action: 'chat',
                text: message
            }));

            // Удаляем индикатор загрузки
            chatArea.removeChild(chatArea.lastChild);

            // Добавляем сообщение об отправке
            addMessage('✅ Сообщение отправлено', false);

            // Разблокируем интерфейс через 1 секунду
            setTimeout(() => {
                messageInput.disabled = false;
                sendButton.disabled = false;
                messageInput.focus();
            }, 1000);

        } catch (error) {
            console.error('Error:', error);
            addMessage('❌ Ошибка отправки сообщения', false);
            
            // Разблокируем интерфейс
            messageInput.disabled = false;
            sendButton.disabled = false;
            messageInput.focus();
        }
    }

    // Обработка нажатия кнопки
    sendButton.addEventListener('click', sendMessage);

    // Обработка нажатия Enter
    messageInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            sendMessage();
        }
    });

    // Фокус на поле ввода
    messageInput.focus();
</script>
</body>
</html>
